<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CodeWire — Persistent process server for AI coding agents</title>
<meta name="description" content="Like tmux, but purpose-built for long-running LLM processes. Persistent sessions, fleet discovery, MCP integration.">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root{
  --bg:#0d0d0d;
  --bg-alt:#161616;
  --bg-code:#1a1a1a;
  --fg:#c8c8c8;
  --fg-dim:#707070;
  --fg-bright:#e8e8e8;
  --accent:#7eb8da;
  --accent-dim:#4a7a96;
  --border:#252525;
  --radius:6px;
  --font-sans:ui-sans-serif,system-ui,-apple-system,sans-serif;
  --font-mono:ui-monospace,"SF Mono","Cascadia Code","Fira Code",Menlo,Consolas,monospace;
  --max-w:780px;
  --header-h:52px;
}

[data-theme="light"]{
  --bg:#f8f8f8;
  --bg-alt:#ffffff;
  --bg-code:#eef1f5;
  --fg:#2a2a2a;
  --fg-dim:#888;
  --fg-bright:#111;
  --accent:#2b6e96;
  --accent-dim:#1a4d6b;
  --border:#ddd;
}

html{scroll-behavior:smooth;scroll-padding-top:calc(var(--header-h) + 24px)}
body{font-family:var(--font-sans);background:var(--bg);color:var(--fg);line-height:1.65;font-size:15px;-webkit-font-smoothing:antialiased}

/* ── Header ── */
header{
  position:sticky;top:0;z-index:100;
  height:var(--header-h);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 24px;
  background:var(--bg);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
}
header .logo{font-family:var(--font-mono);font-weight:700;font-size:16px;color:var(--fg-bright);text-decoration:none;letter-spacing:-.5px}
header .logo span{color:var(--accent)}
header nav{display:flex;align-items:center;gap:20px}
header nav a{color:var(--fg-dim);text-decoration:none;font-size:13px;transition:color .15s}
header nav a:hover{color:var(--fg-bright)}
.theme-toggle{
  background:none;border:1px solid var(--border);border-radius:var(--radius);
  color:var(--fg-dim);cursor:pointer;padding:5px 8px;font-size:14px;
  transition:border-color .15s,color .15s;line-height:1;
}
.theme-toggle:hover{color:var(--fg-bright);border-color:var(--fg-dim)}

.nav-links{display:flex;gap:20px}
@media(max-width:680px){.nav-links{display:none}}

/* ── Layout ── */
main{max-width:var(--max-w);margin:0 auto;padding:0 24px 80px}

section{padding:56px 0 0}
section+section{border-top:1px solid var(--border);margin-top:56px}

h1{font-size:32px;font-weight:700;color:var(--fg-bright);letter-spacing:-.5px;line-height:1.2}
h2{font-size:22px;font-weight:700;color:var(--fg-bright);margin-bottom:16px;letter-spacing:-.3px}
h3{font-size:16px;font-weight:600;color:var(--fg-bright);margin:28px 0 10px}
h4{font-size:14px;font-weight:600;color:var(--accent);margin:20px 0 8px;font-family:var(--font-mono)}

p{margin:10px 0;max-width:62ch}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}

ul,ol{margin:8px 0 8px 20px}
li{margin:4px 0}

/* ── Code ── */
code{
  font-family:var(--font-mono);font-size:13px;
  background:var(--bg-code);padding:2px 6px;border-radius:3px;
}
pre{
  background:var(--bg-code);border:1px solid var(--border);border-radius:var(--radius);
  padding:16px 18px;overflow-x:auto;font-family:var(--font-mono);font-size:13px;
  line-height:1.55;color:var(--fg);position:relative;margin:12px 0;
}
pre code{background:none;padding:0;border-radius:0}

/* Syntax-ish hints */
.kw{color:#c586c0}
.str{color:#ce9178}
.cmt{color:#6a9955}
.fn{color:#dcdcaa}
.num{color:#b5cea8}
.flag{color:#9cdcfe}
.cmd{color:var(--accent)}

/* ── Copy button ── */
.code-block{position:relative}
.copy-btn{
  position:absolute;top:8px;right:8px;
  background:var(--bg-alt);border:1px solid var(--border);border-radius:4px;
  color:var(--fg-dim);cursor:pointer;padding:4px 8px;font-size:11px;
  font-family:var(--font-mono);transition:all .15s;opacity:0;
}
.code-block:hover .copy-btn{opacity:1}
.copy-btn:hover{color:var(--fg-bright);border-color:var(--fg-dim)}
.copy-btn.copied{color:var(--accent);border-color:var(--accent)}

/* ── Hero ── */
.hero{text-align:center;padding:80px 0 40px;border:none}
.hero+section{margin-top:0}
.hero h1{font-size:clamp(28px,5vw,40px);margin-bottom:12px}
.hero .tagline{color:var(--accent);font-family:var(--font-mono);font-size:14px;margin-bottom:16px;letter-spacing:.5px}
.hero .desc{color:var(--fg-dim);font-size:16px;max-width:52ch;margin:0 auto 32px;line-height:1.6}
.hero .install-cmd{
  display:inline-flex;align-items:center;gap:12px;
  background:var(--bg-code);border:1px solid var(--border);border-radius:var(--radius);
  padding:12px 18px;font-family:var(--font-mono);font-size:14px;
}
.hero .install-cmd .prompt{color:var(--fg-dim);user-select:none}
.hero .install-cmd code{background:none;padding:0;font-size:14px;color:var(--fg-bright)}
.hero .install-cmd .copy-btn{position:static;opacity:1}

/* ── Tables ── */
table{width:100%;border-collapse:collapse;margin:12px 0;font-size:13px}
th{text-align:left;padding:8px 12px;border-bottom:2px solid var(--border);color:var(--fg-dim);font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:.5px}
td{padding:8px 12px;border-bottom:1px solid var(--border);vertical-align:top}
td code{font-size:12px}

/* ── Diagrams ── */
.diagram{
  background:var(--bg-code);border:1px solid var(--border);border-radius:var(--radius);
  padding:20px 24px;overflow-x:auto;margin:16px 0;
  font-family:var(--font-mono);font-size:12px;line-height:1.4;
  color:var(--fg);white-space:pre;
}
.diagram .label{color:var(--accent)}
.diagram .dim{color:var(--fg-dim)}
.diagram .hl{color:var(--fg-bright);font-weight:600}

/* ── Quick Start Steps ── */
.steps{counter-reset:step}
.step{
  counter-increment:step;
  padding:16px 0 16px 44px;position:relative;
  border-left:1px solid var(--border);margin-left:14px;
}
.step:last-child{border-left-color:transparent}
.step::before{
  content:counter(step);position:absolute;left:-14px;top:14px;
  width:28px;height:28px;border-radius:50%;
  background:var(--bg-alt);border:2px solid var(--accent);
  color:var(--accent);font-size:13px;font-weight:700;
  display:flex;align-items:center;justify-content:center;
  font-family:var(--font-mono);
}
.step h3{margin-top:0;font-size:15px}

/* ── Command cards ── */
.cmd-group{margin:24px 0}
.cmd-entry{margin:16px 0;padding:12px 0;border-bottom:1px solid var(--border)}
.cmd-entry:last-child{border-bottom:none}
.cmd-sig{font-family:var(--font-mono);font-size:14px;color:var(--fg-bright);margin-bottom:6px}
.cmd-sig .optional{color:var(--fg-dim)}
.cmd-desc{color:var(--fg-dim);font-size:13px;margin-bottom:8px}

/* ── Config keys ── */
.config-key{
  font-family:var(--font-mono);font-size:13px;color:var(--accent);
  display:inline-block;min-width:200px;
}
.config-val{color:var(--fg-dim);font-size:13px}

/* ── Badge row ── */
.badges{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.badge{
  font-family:var(--font-mono);font-size:11px;
  padding:3px 8px;border-radius:3px;
  background:var(--bg-code);border:1px solid var(--border);
  color:var(--fg-dim);
}

/* ── Responsive ── */
@media(max-width:600px){
  header{padding:0 16px}
  main{padding:0 16px 60px}
  .hero{padding:48px 0 24px}
  pre{padding:12px 14px;font-size:12px}
  .diagram{padding:14px 16px;font-size:11px}
  table{font-size:12px}
  th,td{padding:6px 8px}
}
</style>
</head>
<body>

<!-- ════════════════════════ Header ════════════════════════ -->
<header>
  <a href="#" class="logo">code<span>wire</span></a>
  <nav>
    <div class="nav-links">
      <a href="#quickstart">Quick Start</a>
      <a href="#commands">Commands</a>
      <a href="#architecture">Architecture</a>
      <a href="#fleet">Fleet</a>
      <a href="#mcp">MCP</a>
    </div>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
      <span id="theme-icon">&#9790;</span>
    </button>
  </nav>
</header>

<main>

<!-- ════════════════════════ Hero ════════════════════════ -->
<section class="hero" id="top">
  <div class="tagline">Persistent process server for AI coding agents</div>
  <h1>CodeWire</h1>
  <p class="desc">
    Like tmux, but purpose-built for long-running LLM processes.
    Native terminal scrolling, copy/paste, and no weird key chords.
    Multi-attach, fleet discovery, MCP integration.
  </p>
  <div class="install-cmd code-block">
    <span class="prompt">$</span>
    <code>brew install codespacesh/codewire/codewire</code>
    <button class="copy-btn" onclick="copyText('brew install codespacesh/codewire/codewire',this)">copy</button>
  </div>
</section>

<!-- ════════════════════════ Quick Start ════════════════════════ -->
<section id="quickstart">
  <h2>Quick Start</h2>
  <div class="steps">
    <div class="step">
      <h3>Launch a session</h3>
      <p>Start a persistent process in a PTY. It runs in the background even if you disconnect.</p>
      <div class="code-block"><pre><code><span class="cmd">cw launch</span> <span class="flag">--dir</span> ~/project <span class="flag">--</span> claude <span class="flag">-p</span> <span class="str">"refactor the auth module"</span></code></pre><button class="copy-btn" onclick="copyText('cw launch --dir ~/project -- claude -p &quot;refactor the auth module&quot;',this)">copy</button></div>
    </div>
    <div class="step">
      <h3>Attach to it</h3>
      <p>Take over your terminal and interact with the running process. Detach with <code>Ctrl+B d</code>.</p>
      <div class="code-block"><pre><code><span class="cmd">cw attach</span> <span class="num">1</span></code></pre><button class="copy-btn" onclick="copyText('cw attach 1',this)">copy</button></div>
    </div>
    <div class="step">
      <h3>List sessions</h3>
      <p>See all running and completed sessions with their status and age.</p>
      <div class="code-block"><pre><code><span class="cmd">cw list</span>

 <span class="dim">ID  STATUS    AGE     PROMPT</span>
  1  running   2m ago  claude -p "refactor the auth module"
  2  running   45s     claude -p "write unit tests"</code></pre><button class="copy-btn" onclick="copyText('cw list',this)">copy</button></div>
    </div>
    <div class="step">
      <h3>Kill when done</h3>
      <p>Terminate a session or kill all sessions at once.</p>
      <div class="code-block"><pre><code><span class="cmd">cw kill</span> <span class="num">1</span>          <span class="cmt"># kill session 1</span>
<span class="cmd">cw kill</span> <span class="flag">--all</span>      <span class="cmt"># kill everything</span></code></pre><button class="copy-btn" onclick="copyText('cw kill 1',this)">copy</button></div>
    </div>
  </div>
</section>

<!-- ════════════════════════ Commands ════════════════════════ -->
<section id="commands">
  <h2>Commands</h2>
  <p>Global flags: <code>--server &lt;name|url&gt;</code> and <code>--token &lt;token&gt;</code> for remote connections.</p>

  <h3>Sessions</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw launch <span class="optional">[--dir &lt;dir&gt;]</span> -- &lt;command&gt; <span class="optional">[args...]</span></div>
      <div class="cmd-desc">Start a new session running the given command in a persistent PTY.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw attach <span class="optional">[&lt;id&gt;] [--no-history]</span></div>
      <div class="cmd-desc">Connect to a running session. Omit ID to auto-select the oldest unattached session. Detach with <code>Ctrl+B d</code>.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw list <span class="optional">[--json]</span></div>
      <div class="cmd-desc">Show all sessions with status, age, and prompt.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw kill &lt;id&gt; <span class="optional">[--all]</span></div>
      <div class="cmd-desc">Terminate a session. Use <code>--all</code> to kill every session.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw logs &lt;id&gt; <span class="optional">[--follow] [--tail &lt;N&gt;]</span></div>
      <div class="cmd-desc">View captured output without attaching. <code>-f</code> streams new output.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw send &lt;id&gt; <span class="optional">[input] [--stdin] [--file &lt;path&gt;] [--no-newline]</span></div>
      <div class="cmd-desc">Send input to a session without attaching. Read from stdin, file, or argument.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw watch &lt;id&gt; <span class="optional">[--tail &lt;N&gt;] [--no-history] [--timeout &lt;s&gt;]</span></div>
      <div class="cmd-desc">Monitor a session in real-time without attaching. Read-only observation.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw status &lt;id&gt; <span class="optional">[--json]</span></div>
      <div class="cmd-desc">Get detailed session info including PID, output size, and recent output.</div>
    </div>
  </div>

  <h3>Daemon</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw daemon</div>
      <div class="cmd-desc">Start the daemon process. Usually auto-started on first CLI invocation.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw stop</div>
      <div class="cmd-desc">Stop the running daemon gracefully.</div>
    </div>
  </div>

  <h3>Fleet</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw fleet list <span class="optional">[--timeout &lt;s&gt;] [--json]</span></div>
      <div class="cmd-desc">Discover all nodes and their sessions across the fleet. Default timeout: 2s.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw fleet attach &lt;node&gt;:&lt;session_id&gt;</div>
      <div class="cmd-desc">Attach to a remote session. Discovers URL via NATS, connects via WSS.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw fleet launch --on &lt;node&gt; <span class="optional">[--dir &lt;dir&gt;]</span> -- &lt;command&gt; <span class="optional">[args...]</span></div>
      <div class="cmd-desc">Launch a session on a specific node in the fleet.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw fleet kill &lt;node&gt;:&lt;session_id&gt;</div>
      <div class="cmd-desc">Kill a remote session.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw fleet send &lt;node&gt;:&lt;session_id&gt; &lt;text&gt;</div>
      <div class="cmd-desc">Send input to a remote session.</div>
    </div>
  </div>

  <h3>Servers</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw server add &lt;name&gt; &lt;url&gt; --token &lt;token&gt;</div>
      <div class="cmd-desc">Save a remote server connection.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw server remove &lt;name&gt;</div>
      <div class="cmd-desc">Remove a saved server.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw server list</div>
      <div class="cmd-desc">List all saved server connections.</div>
    </div>
  </div>

  <h3>MCP</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw mcp-server</div>
      <div class="cmd-desc">Start the MCP (Model Context Protocol) server over stdin/stdout. Requires the <code>mcp</code> feature.</div>
    </div>
  </div>
</section>

<!-- ════════════════════════ Architecture ════════════════════════ -->
<section id="architecture">
  <h2>Architecture</h2>

  <h3>Daemon Architecture</h3>
  <p>A single Rust binary acts as both daemon and CLI client. The daemon manages PTY sessions and keeps processes alive regardless of client connections.</p>

<div class="diagram" role="img" aria-label="Daemon architecture diagram">
                       <span class="hl">cw daemon</span>
                  <span class="dim">~/.codewire/server.sock</span>

  +----------------------------------------------+
  |              <span class="label">SessionManager</span>                   |
  |           DashMap&lt;u32, Session&gt;               |
  |                                              |
  |   +----------+  +----------+                 |
  |   | <span class="label">Sess 1</span>   |  | <span class="label">Sess 2</span>   |   ...         |
  |   +----+-----+  +----+-----+                 |
  |        |              |                      |
  |   +----+--------------+------+               |
  |   |    Per-Session:          |               |
  |   |                          |               |
  |   |    <span class="dim">+-  PTY master  -+</span>    |               |
  |   |    <span class="dim">|   /dev/ptmx   |</span>    |               |
  |   |    <span class="dim">+---------------+</span>    |               |
  |   |                          |               |
  |   |    <span class="dim">+-  broadcast  --+</span>    |               |
  |   |    <span class="dim">|  4096 buffer  |</span>    |    output     |
  |   |    <span class="dim">+-------+-------+</span>    +-----------&gt;  | <span class="label">clients</span>
  |   |            |             |               |
  |   |    <span class="dim">+-  input chan  --+</span>    |    input      |
  |   |    <span class="dim">|   256 buffer  |</span>    |  &lt;-----------+ |
  |   |    <span class="dim">+---------------+</span>    |               |
  |   |                          |               |
  |   |    <span class="dim">output.log</span>            |               |
  |   +--------------------------+               |
  |                                              |
  |   <span class="dim">sessions.json (debounced 500ms)</span>             |
  +----------------------------------------------+
                       |
            +----------+----------+
            |                     |
       <span class="label">Unix Socket</span>            <span class="label">WebSocket</span>
       <span class="dim">local clients</span>           <span class="dim">:9100 (opt.)</span>
</div>

  <h3>Fleet Topology</h3>
  <p>Two-plane design: NATS for lightweight control messages (discovery, launch, kill) and WSS for heavy data plane (PTY streaming). NATS never carries binary PTY data.</p>

<div class="diagram" role="img" aria-label="Fleet topology diagram">
   <span class="hl">NATS Control Plane</span>                     <span class="hl">WSS Data Plane</span>
  <span class="dim">discovery, commands (JSON)</span>               <span class="dim">PTY streaming (binary)</span>

  +------------+  <span class="dim">cw.fleet.discover</span>   +------------+
  |  <span class="label">Node A</span>    |&lt;--------------------&gt;|  <span class="label">Node B</span>    |
  |   :9100    |  <span class="dim">cw.fleet.heartbeat</span>  |   :9100    |
  |            |                      |            |
  |  sess 1,2  |  <span class="dim">cw.&lt;node&gt;.list</span>      |  sess 1,3  |
  +-----+------+  <span class="dim">cw.&lt;node&gt;.launch</span>    +-----+------+
        |         <span class="dim">cw.&lt;node&gt;.kill</span>            |
        |         <span class="dim">cw.&lt;node&gt;.status</span>          |
        |         <span class="dim">cw.&lt;node&gt;.send</span>            |
        |                                  |
        +----------+    +-----------------+
                   |    |
              +----+----+----+
              |  <span class="label">NATS Server</span>  |
              |  <span class="dim">:4222</span>        |
              +--------------+

  <span class="hl">Fleet Attach Flow:</span>
  1. Client sends Discover via NATS
  2. Target node replies with external_url
  3. Client connects directly via WSS <span class="dim">(wss://node:9100/ws)</span>
  4. Binary PTY frames flow over WebSocket
</div>

  <h3>Wire Protocol</h3>
  <p>Binary frame-based protocol used over both Unix socket and WebSocket.</p>

<div class="diagram" role="img" aria-label="Wire protocol frame format">
  <span class="hl">Frame Format</span>
  +----------+---------------+----------------------+
  | <span class="label">type</span>     | <span class="label">length</span>        | <span class="label">payload</span>              |
  | 1 byte   | 4 bytes (BE)  | up to 16 MB          |
  +----------+---------------+----------------------+

  <span class="dim">type = 0x00</span>  Control  <span class="dim">-- JSON-encoded Request/Response</span>
  <span class="dim">type = 0x01</span>  Data     <span class="dim">-- Raw bytes (PTY I/O)</span>

  <span class="hl">WebSocket Mapping</span>
  Text   frames -- Control messages (JSON)
  Binary frames -- Data messages (raw bytes)
</div>
</section>

<!-- ════════════════════════ Configuration ════════════════════════ -->
<section id="configuration">
  <h2>Configuration</h2>

  <h3>Config File</h3>
  <p>Located at <code>~/.codewire/config.toml</code></p>
  <div class="code-block"><pre><code><span class="cmt"># Daemon settings</span>
<span class="kw">[daemon]</span>
<span class="flag">name</span> = <span class="str">"my-node"</span>                    <span class="cmt"># Node name for fleet (alphanumeric, -, _)</span>
<span class="flag">listen</span> = <span class="str">"0.0.0.0:9100"</span>             <span class="cmt"># WebSocket listener address</span>
<span class="flag">external_url</span> = <span class="str">"wss://host/ws"</span>      <span class="cmt"># Advertised URL for fleet attach</span>

<span class="cmt"># NATS connection (enables fleet features)</span>
<span class="kw">[nats]</span>
<span class="flag">url</span> = <span class="str">"nats://nats.example.com:4222"</span>
<span class="flag">token</span> = <span class="str">"secret"</span>                     <span class="cmt"># Optional token auth</span>
<span class="flag">creds_file</span> = <span class="str">"~/.codewire/fleet.creds"</span>  <span class="cmt"># Optional credentials file</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>Environment Variable Overrides</h3>
  <table>
    <thead><tr><th>Variable</th><th>Overrides</th></tr></thead>
    <tbody>
      <tr><td><code>CODEWIRE_DAEMON_NAME</code></td><td>daemon.name</td></tr>
      <tr><td><code>CODEWIRE_LISTEN</code></td><td>daemon.listen</td></tr>
      <tr><td><code>CODEWIRE_EXTERNAL_URL</code></td><td>daemon.external_url</td></tr>
      <tr><td><code>CODEWIRE_TOKEN</code></td><td>Auth token (for containers)</td></tr>
      <tr><td><code>CODEWIRE_NATS_URL</code></td><td>nats.url</td></tr>
      <tr><td><code>CODEWIRE_NATS_TOKEN</code></td><td>nats.token</td></tr>
      <tr><td><code>CODEWIRE_NATS_CREDS</code></td><td>nats.creds_file</td></tr>
    </tbody>
  </table>

  <h3>Data Directory</h3>
  <p><code>~/.codewire/</code> contains all runtime state.</p>
<div class="diagram" role="img" aria-label="Data directory layout">
~/.codewire/
|-- server.sock           <span class="dim"># Unix domain socket</span>
|-- daemon.pid            <span class="dim"># Daemon PID file</span>
|-- token                 <span class="dim"># Auth token (mode 0600)</span>
|-- config.toml           <span class="dim"># Configuration</span>
|-- servers.toml          <span class="dim"># Saved remote servers</span>
|-- sessions.json         <span class="dim"># Session metadata</span>
`-- sessions/
    |-- 1/
    |   `-- output.log    <span class="dim"># Captured PTY output</span>
    `-- 2/
        `-- output.log
</div>

  <h3>Auto-Discovery</h3>
  <p>If <code>/etc/codewire/nats.creds</code> exists (e.g. mounted by a Coder template), the daemon automatically configures NATS:</p>
  <div class="code-block"><pre><code><span class="flag">url</span> = <span class="str">"nats://nats.codespace-system:4222"</span>
<span class="flag">creds_file</span> = <span class="str">"/etc/codewire/nats.creds"</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>
</section>

<!-- ════════════════════════ Fleet ════════════════════════ -->
<section id="fleet">
  <h2>Fleet</h2>
  <p>Fleet mode enables multi-node orchestration via NATS discovery and WebSocket data plane. Requires the <code>nats</code> feature.</p>

  <h3>NATS Setup</h3>
  <p>Point each node at a shared NATS server. Each node advertises itself and responds to fleet commands.</p>
  <div class="code-block"><pre><code><span class="cmt"># On each node: ~/.codewire/config.toml</span>
<span class="kw">[daemon]</span>
<span class="flag">name</span> = <span class="str">"gpu-box"</span>
<span class="flag">listen</span> = <span class="str">"0.0.0.0:9100"</span>
<span class="flag">external_url</span> = <span class="str">"wss://gpu-box.example.com/ws"</span>

<span class="kw">[nats]</span>
<span class="flag">url</span> = <span class="str">"nats://nats.example.com:4222"</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>Discovery</h3>
  <p>Nodes publish heartbeats every 30s on <code>cw.fleet.heartbeat</code>. Clients broadcast on <code>cw.fleet.discover</code> and collect responses.</p>
  <div class="code-block"><pre><code><span class="cmt"># List all nodes and sessions</span>
<span class="cmd">cw fleet list</span>

 <span class="dim">NODE        SESSIONS  UPTIME</span>
  gpu-box    3         2h 15m
  dev-01     1         45m

<span class="cmt"># Launch on a specific node</span>
<span class="cmd">cw fleet launch</span> <span class="flag">--on</span> gpu-box <span class="flag">--</span> claude <span class="flag">-p</span> <span class="str">"train the model"</span>

<span class="cmt"># Attach to a remote session</span>
<span class="cmd">cw fleet attach</span> gpu-box:1</code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>NATS Subjects</h3>
  <table>
    <thead><tr><th>Subject</th><th>Pattern</th><th>Purpose</th></tr></thead>
    <tbody>
      <tr><td><code>cw.fleet.discover</code></td><td>Broadcast</td><td>All nodes reply with info</td></tr>
      <tr><td><code>cw.fleet.heartbeat</code></td><td>Publish</td><td>Periodic node announcements</td></tr>
      <tr><td><code>cw.&lt;node&gt;.list</code></td><td>Request-reply</td><td>List sessions on node</td></tr>
      <tr><td><code>cw.&lt;node&gt;.launch</code></td><td>Request-reply</td><td>Launch session on node</td></tr>
      <tr><td><code>cw.&lt;node&gt;.kill</code></td><td>Request-reply</td><td>Kill session on node</td></tr>
      <tr><td><code>cw.&lt;node&gt;.status</code></td><td>Request-reply</td><td>Get session status</td></tr>
      <tr><td><code>cw.&lt;node&gt;.send</code></td><td>Request-reply</td><td>Send input to session</td></tr>
    </tbody>
  </table>
</section>

<!-- ════════════════════════ MCP ════════════════════════ -->
<section id="mcp">
  <h2>MCP Integration</h2>
  <p>CodeWire exposes an MCP server (JSON-RPC 2.0 over stdin/stdout) so AI agents can programmatically manage sessions.</p>

  <h3>Claude Code Config</h3>
  <p>Add to your Claude Code MCP settings:</p>
  <div class="code-block"><pre><code>{
  <span class="str">"mcpServers"</span>: {
    <span class="str">"codewire"</span>: {
      <span class="str">"command"</span>: <span class="str">"cw"</span>,
      <span class="str">"args"</span>: [<span class="str">"mcp-server"</span>]
    }
  }
}</code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>Available Tools</h3>
  <table>
    <thead><tr><th>Tool</th><th>Description</th><th>Key Parameters</th></tr></thead>
    <tbody>
      <tr>
        <td><code>codewire_launch_session</code></td>
        <td>Launch a new session</td>
        <td><code>command</code> (required), <code>working_dir</code></td>
      </tr>
      <tr>
        <td><code>codewire_list_sessions</code></td>
        <td>List all sessions</td>
        <td><code>status_filter</code>: all | running | completed</td>
      </tr>
      <tr>
        <td><code>codewire_read_session_output</code></td>
        <td>Read output snapshot</td>
        <td><code>session_id</code>, <code>tail</code>, <code>max_chars</code> (50000)</td>
      </tr>
      <tr>
        <td><code>codewire_send_input</code></td>
        <td>Send input to session</td>
        <td><code>session_id</code>, <code>input</code>, <code>auto_newline</code> (true)</td>
      </tr>
      <tr>
        <td><code>codewire_watch_session</code></td>
        <td>Monitor (time-bounded)</td>
        <td><code>session_id</code>, <code>max_duration_seconds</code> (30)</td>
      </tr>
      <tr>
        <td><code>codewire_get_session_status</code></td>
        <td>Detailed session info</td>
        <td><code>session_id</code></td>
      </tr>
      <tr>
        <td><code>codewire_kill_session</code></td>
        <td>Terminate a session</td>
        <td><code>session_id</code></td>
      </tr>
    </tbody>
  </table>

  <h3>Multi-Agent Patterns</h3>
  <p>CodeWire enables several multi-agent coordination patterns:</p>
  <ul>
    <li><strong>Multiple Attachments</strong> &mdash; Multiple clients can attach to the same session simultaneously</li>
    <li><strong>Supervisor Pattern</strong> &mdash; One orchestrator agent launches and coordinates worker agents</li>
    <li><strong>Agent Swarms</strong> &mdash; Parallel agents working on different tasks, coordinated via <code>send</code> and <code>watch</code></li>
    <li><strong>Cross-Session Communication</strong> &mdash; Use <code>cw send</code> and <code>cw watch</code> to pipe data between sessions</li>
  </ul>
</section>

<!-- ════════════════════════ Installation ════════════════════════ -->
<section id="installation">
  <h2>Installation</h2>

  <h3>Homebrew</h3>
  <div class="badges">
    <span class="badge">macOS aarch64</span>
    <span class="badge">macOS x86_64</span>
    <span class="badge">Linux aarch64</span>
    <span class="badge">Linux x86_64</span>
  </div>
  <div class="code-block"><pre><code><span class="cmd">brew install</span> codespacesh/codewire/codewire</code></pre><button class="copy-btn" onclick="copyText('brew install codespacesh/codewire/codewire',this)">copy</button></div>

  <h3>Install Script</h3>
  <p>Downloads the binary, verifies GPG signature and SHA256 checksum.</p>
  <div class="code-block"><pre><code><span class="cmd">curl</span> <span class="flag">-fsSL</span> https://raw.githubusercontent.com/codespacesh/codewire/main/install.sh <span class="flag">|</span> bash</code></pre><button class="copy-btn" onclick="copyText('curl -fsSL https://raw.githubusercontent.com/codespacesh/codewire/main/install.sh | bash',this)">copy</button></div>
  <p>Options: <code>--version VERSION</code>, <code>--prefix DIR</code>, <code>--verbose</code></p>

  <h3>Build from Source</h3>
  <div class="code-block"><pre><code><span class="cmt"># Default (includes WebSocket support)</span>
<span class="cmd">cargo install</span> <span class="flag">--path</span> .

<span class="cmt"># With fleet discovery</span>
<span class="cmd">cargo build</span> <span class="flag">--release --features</span> nats

<span class="cmt"># With MCP server</span>
<span class="cmd">cargo build</span> <span class="flag">--release --features</span> mcp

<span class="cmt"># Everything</span>
<span class="cmd">cargo build</span> <span class="flag">--release --all-features</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>
  <div class="badges">
    <span class="badge">default = ws</span>
    <span class="badge">nats (implies ws)</span>
    <span class="badge">mcp</span>
  </div>

  <h3>Coder Module</h3>
  <p>Add CodeWire to Coder workspaces with a Terraform module:</p>
  <div class="code-block"><pre><code><span class="kw">module</span> <span class="str">"codewire"</span> {
  <span class="flag">source</span>   = <span class="str">"github.com/codespacesh/codewire//coder-module"</span>
  <span class="flag">agent_id</span> = coder_agent.main.id
  <span class="flag">folder</span>   = <span class="str">"/home/coder/project"</span>
}</code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <table>
    <thead><tr><th>Variable</th><th>Default</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>agent_id</code></td><td><em>required</em></td><td>The ID of a Coder agent</td></tr>
      <tr><td><code>folder</code></td><td><code>/home/coder</code></td><td>Working directory for sessions</td></tr>
      <tr><td><code>install_codewire</code></td><td><code>true</code></td><td>Whether to install cw</td></tr>
      <tr><td><code>codewire_version</code></td><td><code>latest</code></td><td>Version to install</td></tr>
      <tr><td><code>experiment_report_tasks</code></td><td><code>false</code></td><td>Enable Coder MCP task reporting</td></tr>
    </tbody>
  </table>
</section>

</main>

<!-- ════════════════════════ Footer ════════════════════════ -->
<footer style="text-align:center;padding:24px;border-top:1px solid var(--border);color:var(--fg-dim);font-size:12px;font-family:var(--font-mono)">
  <a href="https://github.com/codespacesh/codewire" style="color:var(--fg-dim)">github.com/codespacesh/codewire</a>
  &nbsp;&middot;&nbsp; MIT License
</footer>

<script>
// ── Theme Toggle ──
function getPreferredTheme() {
  const saved = localStorage.getItem('cw-theme');
  if (saved) return saved;
  return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
}

function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  document.getElementById('theme-icon').textContent = theme === 'light' ? '\u2600' : '\u263E';
}

function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme') || 'dark';
  const next = current === 'dark' ? 'light' : 'dark';
  localStorage.setItem('cw-theme', next);
  applyTheme(next);
}

applyTheme(getPreferredTheme());

window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', (e) => {
  if (!localStorage.getItem('cw-theme')) {
    applyTheme(e.matches ? 'light' : 'dark');
  }
});

// ── Copy Buttons ──
function copyText(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'copied';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'copy';
      btn.classList.remove('copied');
    }, 1500);
  });
}

function copySnippet(btn) {
  const pre = btn.closest('.code-block').querySelector('pre');
  const text = pre.textContent;
  copyText(text, btn);
}
</script>
</body>
</html>
