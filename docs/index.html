<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CodeWire — Persistent process server for AI coding agents</title>
<meta name="description" content="Like tmux, but purpose-built for long-running LLM processes. Persistent sessions, WireGuard relay, event-driven orchestration, MCP integration.">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root{
  --bg:#0d0d0d;
  --bg-alt:#161616;
  --bg-code:#1a1a1a;
  --fg:#c8c8c8;
  --fg-dim:#707070;
  --fg-bright:#e8e8e8;
  --accent:#7eb8da;
  --accent-dim:#4a7a96;
  --border:#252525;
  --radius:8px;
  --font-sans:ui-sans-serif,system-ui,-apple-system,sans-serif;
  --font-mono:ui-monospace,"SF Mono","Cascadia Code","Fira Code",Menlo,Consolas,monospace;
  --max-w:780px;
  --header-h:52px;
}

[data-theme="light"]{
  --bg:#f8f8f8;
  --bg-alt:#ffffff;
  --bg-code:#eef1f5;
  --fg:#2a2a2a;
  --fg-dim:#888;
  --fg-bright:#111;
  --accent:#2b6e96;
  --accent-dim:#1a4d6b;
  --border:#ddd;
}

html{scroll-behavior:smooth;scroll-padding-top:calc(var(--header-h) + 24px)}
body{font-family:var(--font-sans);background:var(--bg);color:var(--fg);line-height:1.65;font-size:15px;-webkit-font-smoothing:antialiased}

/* ── Header ── */
header{
  position:sticky;top:0;z-index:100;
  height:var(--header-h);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 24px;
  background:var(--bg);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
}
header .logo{font-family:var(--font-mono);font-weight:700;font-size:16px;color:var(--fg-bright);text-decoration:none;letter-spacing:-.5px}
header .logo span{color:var(--accent)}
header nav{display:flex;align-items:center;gap:20px}
header nav a{color:var(--fg-dim);text-decoration:none;font-size:13px;transition:color .15s}
header nav a:hover{color:var(--fg-bright)}
.theme-toggle{
  background:none;border:1px solid var(--border);border-radius:var(--radius);
  color:var(--fg-dim);cursor:pointer;padding:5px 8px;font-size:14px;
  transition:border-color .15s,color .15s;line-height:1;
}
.theme-toggle:hover{color:var(--fg-bright);border-color:var(--fg-dim)}

.nav-links{display:flex;gap:20px}
@media(max-width:680px){.nav-links{display:none}}

/* ── Layout ── */
main{max-width:var(--max-w);margin:0 auto;padding:0 24px 80px}

section{padding:56px 0 0}
section+section{border-top:1px solid var(--border);margin-top:56px}

h1{font-size:32px;font-weight:700;color:var(--fg-bright);letter-spacing:-.5px;line-height:1.2}
h2{font-size:22px;font-weight:700;color:var(--fg-bright);margin-bottom:16px;letter-spacing:-.3px}
h3{font-size:16px;font-weight:600;color:var(--fg-bright);margin:28px 0 10px}
h4{font-size:14px;font-weight:600;color:var(--accent);margin:20px 0 8px;font-family:var(--font-mono)}

p{margin:10px 0;max-width:62ch}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}

ul,ol{margin:8px 0 8px 20px}
li{margin:4px 0}

/* ── Code ── */
code{
  font-family:var(--font-mono);font-size:13px;
  background:var(--bg-code);padding:2px 6px;border-radius:3px;
}
pre{
  background:var(--bg-code);border:1px solid var(--border);border-radius:var(--radius);
  padding:16px 18px;overflow-x:auto;font-family:var(--font-mono);font-size:13px;
  line-height:1.55;color:var(--fg);position:relative;margin:12px 0;
}
pre code{background:none;padding:0;border-radius:0}

/* Syntax-ish hints */
.kw{color:#c586c0}
.str{color:#ce9178}
.cmt{color:#6a9955}
.fn{color:#dcdcaa}
.num{color:#b5cea8}
.flag{color:#9cdcfe}
.cmd{color:var(--accent)}

/* ── Copy button ── */
.code-block{position:relative}
.copy-btn{
  position:absolute;top:8px;right:8px;
  background:var(--bg-alt);border:1px solid var(--border);border-radius:4px;
  color:var(--fg-dim);cursor:pointer;padding:4px 8px;font-size:11px;
  font-family:var(--font-mono);transition:all .15s;opacity:0;
}
.code-block:hover .copy-btn{opacity:1}
.copy-btn:hover{color:var(--fg-bright);border-color:var(--fg-dim)}
.copy-btn.copied{color:var(--accent);border-color:var(--accent)}

/* ── Hero ── */
.hero{text-align:center;padding:80px 0 40px;border:none}
.hero+section{margin-top:0}
.hero h1{font-size:clamp(28px,5vw,40px);margin-bottom:12px}
.hero .tagline{color:var(--accent);font-family:var(--font-mono);font-size:14px;margin-bottom:16px;letter-spacing:.5px}
.hero .desc{color:var(--fg-dim);font-size:16px;max-width:52ch;margin:0 auto 32px;line-height:1.6}
.hero .install-cmd{
  display:inline-flex;align-items:center;gap:12px;
  background:var(--bg-code);border:1px solid var(--border);border-radius:var(--radius);
  padding:12px 18px;font-family:var(--font-mono);font-size:14px;
}
.hero .install-cmd .prompt{color:var(--fg-dim);user-select:none}
.hero .install-cmd code{background:none;padding:0;font-size:14px;color:var(--fg-bright)}
.hero .install-cmd .copy-btn{position:static;opacity:1}

/* ── Tables ── */
table{width:100%;border-collapse:collapse;margin:12px 0;font-size:13px}
th{text-align:left;padding:8px 12px;border-bottom:2px solid var(--border);color:var(--fg-dim);font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:.5px}
td{padding:8px 12px;border-bottom:1px solid var(--border);vertical-align:top}
td code{font-size:12px}

/* ── Diagrams ── */
.diagram{
  background:var(--bg-code);border:1px solid var(--border);border-radius:var(--radius);
  padding:20px 24px;overflow-x:auto;margin:16px 0;
  font-family:var(--font-mono);font-size:12px;line-height:1.4;
  color:var(--fg);white-space:pre;
}
.diagram .label{color:var(--accent)}
.diagram .dim{color:var(--fg-dim)}
.diagram .hl{color:var(--fg-bright);font-weight:600}

/* ── Quick Start Steps ── */
.steps{counter-reset:step}
.step{
  counter-increment:step;
  padding:16px 0 16px 44px;position:relative;
  border-left:1px solid var(--border);margin-left:14px;
}
.step:last-child{border-left-color:transparent}
.step::before{
  content:counter(step);position:absolute;left:-14px;top:14px;
  width:28px;height:28px;border-radius:50%;
  background:var(--bg-alt);border:2px solid var(--accent);
  color:var(--accent);font-size:13px;font-weight:700;
  display:flex;align-items:center;justify-content:center;
  font-family:var(--font-mono);
}
.step h3{margin-top:0;font-size:15px}

/* ── Command cards ── */
.cmd-group{margin:24px 0}
.cmd-entry{margin:16px 0;padding:12px 0;border-bottom:1px solid var(--border)}
.cmd-entry:last-child{border-bottom:none}
.cmd-sig{font-family:var(--font-mono);font-size:14px;color:var(--fg-bright);margin-bottom:6px}
.cmd-sig .optional{color:var(--fg-dim)}
.cmd-desc{color:var(--fg-dim);font-size:13px;margin-bottom:8px}

/* ── Config keys ── */
.config-key{
  font-family:var(--font-mono);font-size:13px;color:var(--accent);
  display:inline-block;min-width:200px;
}
.config-val{color:var(--fg-dim);font-size:13px}

/* ── Badge row ── */
.badges{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.badge{
  font-family:var(--font-mono);font-size:11px;
  padding:3px 8px;border-radius:3px;
  background:var(--bg-code);border:1px solid var(--border);
  color:var(--fg-dim);
}

/* ── Responsive ── */
@media(max-width:600px){
  header{padding:0 16px}
  main{padding:0 16px 60px}
  .hero{padding:48px 0 24px}
  pre{padding:12px 14px;font-size:12px}
  .diagram{padding:14px 16px;font-size:11px}
  table{font-size:12px}
  th,td{padding:6px 8px}
}
</style>
</head>
<body>

<!-- ════════════════════════ Header ════════════════════════ -->
<header>
  <a href="#" class="logo">code<span>wire</span></a>
  <nav>
    <div class="nav-links">
      <a href="#quickstart">Quick Start</a>
      <a href="#commands">Commands</a>
      <a href="#orchestration">Orchestration</a>
      <a href="#relay">Relay</a>
      <a href="#mcp">MCP</a>
    </div>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
      <span id="theme-icon">&#9790;</span>
    </button>
  </nav>
</header>

<main>

<!-- ════════════════════════ Hero ════════════════════════ -->
<section class="hero" id="top">
  <div class="tagline">Persistent process server for AI coding agents</div>
  <h1>CodeWire</h1>
  <p class="desc">
    Like tmux, but purpose-built for long-running LLM processes.
    Native terminal scrolling, copy/paste, and no weird key chords.
    Tags, subscriptions, wait &mdash; LLM orchestration primitives built in.
  </p>
  <div class="install-cmd code-block">
    <span class="prompt">$</span>
    <code>brew install codespacesh/codewire/codewire</code>
    <button class="copy-btn" onclick="copyText('brew install codespacesh/codewire/codewire',this)">copy</button>
  </div>
</section>

<!-- ════════════════════════ Quick Start ════════════════════════ -->
<section id="quickstart">
  <h2>Quick Start</h2>
  <div class="steps">
    <div class="step">
      <h3>Launch a session</h3>
      <p>Start a persistent process in a PTY. It runs in the background even if you disconnect.</p>
      <div class="code-block"><pre><code><span class="cmd">cw launch</span> <span class="flag">--dir</span> ~/project <span class="flag">--tag</span> worker <span class="flag">--</span> claude <span class="flag">-p</span> <span class="str">"refactor the auth module"</span></code></pre><button class="copy-btn" onclick="copyText('cw launch --dir ~/project --tag worker -- claude -p &quot;refactor the auth module&quot;',this)">copy</button></div>
    </div>
    <div class="step">
      <h3>Attach to it</h3>
      <p>Take over your terminal and interact with the running process. Detach with <code>Ctrl+B d</code>.</p>
      <div class="code-block"><pre><code><span class="cmd">cw attach</span> <span class="num">1</span></code></pre><button class="copy-btn" onclick="copyText('cw attach 1',this)">copy</button></div>
    </div>
    <div class="step">
      <h3>List sessions</h3>
      <p>See all running and completed sessions with their status, tags, and age.</p>
      <div class="code-block"><pre><code><span class="cmd">cw list</span>

 <span class="dim">ID  STATUS     TAGS           AGE     PROMPT</span>
  1  running    worker,build   2m ago  claude -p "refactor the auth module"
  2  completed  worker         45s     claude -p "write unit tests"</code></pre><button class="copy-btn" onclick="copyText('cw list',this)">copy</button></div>
    </div>
    <div class="step">
      <h3>Wait or kill</h3>
      <p>Block until sessions complete, or kill by ID or tag.</p>
      <div class="code-block"><pre><code><span class="cmd">cw wait</span> <span class="flag">--tag</span> worker <span class="flag">--condition</span> all   <span class="cmt"># block until all workers finish</span>
<span class="cmd">cw kill</span> <span class="flag">--tag</span> worker                    <span class="cmt"># kill all workers</span>
<span class="cmd">cw kill</span> <span class="num">1</span>                                <span class="cmt"># kill session 1</span></code></pre><button class="copy-btn" onclick="copyText('cw wait --tag worker --condition all',this)">copy</button></div>
    </div>
  </div>
</section>

<!-- ════════════════════════ Commands ════════════════════════ -->
<section id="commands">
  <h2>Commands</h2>
  <p>Global flags: <code>--server &lt;name|url&gt;</code> and <code>--token &lt;token&gt;</code> for remote connections. All commands accept an optional node prefix for remote access (e.g. <code>cw list dev-1</code>).</p>

  <h3>Sessions</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw launch <span class="optional">[--dir &lt;dir&gt;] [--tag &lt;tag&gt;...]</span> -- &lt;command&gt; <span class="optional">[args...]</span></div>
      <div class="cmd-desc">Start a new session in a persistent PTY. Tags enable filtering and orchestration.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw attach <span class="optional">[&lt;id&gt;] [--no-history]</span></div>
      <div class="cmd-desc">Connect to a running session. Omit ID to auto-select the oldest unattached session. Detach with <code>Ctrl+B d</code>.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw list <span class="optional">[node] [--json]</span></div>
      <div class="cmd-desc">Show all sessions with status, tags, age, and prompt. Enriched metadata includes exit code, duration, output stats.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw kill &lt;id&gt; <span class="optional">[--all] [--tag &lt;tag&gt;]</span></div>
      <div class="cmd-desc">Terminate a session. Use <code>--all</code> to kill everything, or <code>--tag</code> to kill by tag.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw logs &lt;id&gt; <span class="optional">[--follow] [--tail &lt;N&gt;]</span></div>
      <div class="cmd-desc">View captured output without attaching. <code>-f</code> streams new output.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw send &lt;id&gt; <span class="optional">[input] [--stdin] [--file &lt;path&gt;] [--no-newline]</span></div>
      <div class="cmd-desc">Send input to a session without attaching. Read from stdin, file, or argument.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw watch &lt;id&gt; <span class="optional">[--tail &lt;N&gt;] [--no-history] [--timeout &lt;s&gt;]</span></div>
      <div class="cmd-desc">Monitor a session in real-time without attaching. Read-only observation.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw status &lt;id&gt; <span class="optional">[--json]</span></div>
      <div class="cmd-desc">Get detailed session info including exit code, duration, tags, PID, and output stats.</div>
    </div>
  </div>

  <h3>Orchestration</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw subscribe <span class="optional">[node] [--tag &lt;tag&gt;] [--event &lt;type&gt;] [--session &lt;id&gt;]</span></div>
      <div class="cmd-desc">Subscribe to real-time session events. Events stream until disconnect.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw wait <span class="optional">[node:]&lt;id&gt; [--tag &lt;tag&gt;] [--condition all|any] [--timeout &lt;s&gt;]</span></div>
      <div class="cmd-desc">Block until sessions complete. Wait by ID, tag, or both.</div>
    </div>
  </div>

  <h3>Remote</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw nodes</div>
      <div class="cmd-desc">List all nodes registered with the relay.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw setup <span class="optional">[relay-url]</span></div>
      <div class="cmd-desc">Authorize this node with a relay using the device authorization flow.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw relay <span class="optional">[--base-url &lt;url&gt;] [--data-dir &lt;dir&gt;] [--auth-mode &lt;mode&gt;]</span></div>
      <div class="cmd-desc">Run a relay server (WireGuard tunneling, node discovery, shared KV).</div>
    </div>
  </div>

  <h3>Shared KV</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw kv set <span class="optional">[--ns &lt;namespace&gt;] [--ttl &lt;duration&gt;]</span> &lt;key&gt; &lt;value&gt;</div>
      <div class="cmd-desc">Set a key-value pair on the relay's shared store.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw kv get <span class="optional">[--ns &lt;namespace&gt;]</span> &lt;key&gt;</div>
      <div class="cmd-desc">Get a value by key.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw kv list <span class="optional">[--ns &lt;namespace&gt;]</span> <span class="optional">[prefix]</span></div>
      <div class="cmd-desc">List keys by prefix.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw kv delete <span class="optional">[--ns &lt;namespace&gt;]</span> &lt;key&gt;</div>
      <div class="cmd-desc">Delete a key.</div>
    </div>
  </div>

  <h3>Node &amp; Servers</h3>
  <div class="cmd-group">
    <div class="cmd-entry">
      <div class="cmd-sig">cw node</div>
      <div class="cmd-desc">Start the node process. Usually auto-started on first CLI invocation.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw stop</div>
      <div class="cmd-desc">Stop the running node gracefully.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw server add &lt;name&gt; &lt;url&gt; <span class="optional">[--token &lt;token&gt;]</span></div>
      <div class="cmd-desc">Save a remote server or relay connection. Token optional for relay URLs.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw server remove &lt;name&gt;</div>
      <div class="cmd-desc">Remove a saved server.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw server list</div>
      <div class="cmd-desc">List all saved server connections.</div>
    </div>
    <div class="cmd-entry">
      <div class="cmd-sig">cw mcp-server</div>
      <div class="cmd-desc">Start the MCP (Model Context Protocol) server over stdin/stdout.</div>
    </div>
  </div>
</section>

<!-- ════════════════════════ Orchestration ════════════════════════ -->
<section id="orchestration">
  <h2>LLM Orchestration</h2>
  <p>CodeWire is designed for LLM-driven multi-agent workflows. Tags, subscriptions, and wait provide structured coordination primitives &mdash; no polling, no output parsing.</p>

  <h3>Tags</h3>
  <p>Label sessions at launch for filtering and coordination.</p>
  <div class="code-block"><pre><code><span class="cmd">cw launch</span> <span class="flag">--tag</span> worker <span class="flag">--tag</span> build <span class="flag">--</span> claude <span class="flag">-p</span> <span class="str">"fix tests"</span>
<span class="cmd">cw launch</span> <span class="flag">--tag</span> worker <span class="flag">--tag</span> lint <span class="flag">--</span> claude <span class="flag">-p</span> <span class="str">"fix lint issues"</span>
<span class="cmd">cw kill</span> <span class="flag">--tag</span> worker          <span class="cmt"># kill all workers</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>Subscribe to Events</h3>
  <p>Stream structured, typed events from sessions in real-time.</p>
  <div class="code-block"><pre><code><span class="cmd">cw subscribe</span> <span class="flag">--tag</span> worker <span class="flag">--event</span> session.status
<span class="cmd">cw subscribe</span> <span class="flag">--session</span> <span class="num">3</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>
  <p>Event types: <code>session.created</code>, <code>session.status</code>, <code>session.output_summary</code>, <code>session.input</code>, <code>session.attached</code>, <code>session.detached</code></p>

  <h3>Wait for Completion</h3>
  <p>Block until sessions finish &mdash; replaces polling.</p>
  <div class="code-block"><pre><code><span class="cmd">cw wait</span> <span class="num">3</span>                                         <span class="cmt"># wait for session 3</span>
<span class="cmd">cw wait</span> <span class="flag">--tag</span> worker <span class="flag">--condition</span> all              <span class="cmt"># ALL workers</span>
<span class="cmd">cw wait</span> <span class="flag">--tag</span> worker <span class="flag">--condition</span> any <span class="flag">--timeout</span> <span class="num">60</span> <span class="cmt"># ANY, 60s</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>Supervisor Pattern</h3>
  <div class="code-block"><pre><code><span class="cmt"># Launch tagged workers</span>
<span class="cmd">cw launch</span> <span class="flag">--tag</span> worker <span class="flag">--</span> claude <span class="flag">-p</span> <span class="str">"implement feature X"</span>
<span class="cmd">cw launch</span> <span class="flag">--tag</span> worker <span class="flag">--</span> claude <span class="flag">-p</span> <span class="str">"write tests for X"</span>

<span class="cmt"># Wait for all to complete</span>
<span class="cmd">cw wait</span> <span class="flag">--tag</span> worker <span class="flag">--condition</span> all <span class="flag">--timeout</span> <span class="num">300</span>

<span class="cmt"># Check results</span>
<span class="cmd">cw list</span> <span class="flag">--json</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>Multi-Agent Patterns</h3>
  <ul>
    <li><strong>Multiple Attachments</strong> &mdash; Multiple clients can attach to the same session simultaneously</li>
    <li><strong>Supervisor</strong> &mdash; One orchestrator launches and waits on tagged worker sessions</li>
    <li><strong>Agent Swarms</strong> &mdash; Parallel agents with event subscriptions for coordination</li>
    <li><strong>Cross-Session</strong> &mdash; Use <code>cw send</code> and <code>cw watch</code> to pipe data between sessions</li>
    <li><strong>Shared State</strong> &mdash; Use <code>cw kv</code> for cross-node key-value coordination (relay mode)</li>
  </ul>
</section>

<!-- ════════════════════════ Architecture ════════════════════════ -->
<section id="architecture">
  <h2>Architecture</h2>

  <h3>Node Architecture</h3>
  <p>A single Go binary acts as both node and CLI client. The node manages PTY sessions and keeps processes alive regardless of client connections.</p>

<div class="diagram" role="img" aria-label="Node architecture diagram">
                       <span class="hl">cw node</span>
                  <span class="dim">~/.codewire/codewire.sock</span>

  +----------------------------------------------+
  |              <span class="label">SessionManager</span>                   |
  |                                              |
  |   +----------+  +----------+                 |
  |   | <span class="label">Sess 1</span>   |  | <span class="label">Sess 2</span>   |   ...         |
  |   +----+-----+  +----+-----+                 |
  |        |              |                      |
  |   +----+--------------+------+               |
  |   |    Per-Session:          |               |
  |   |                          |               |
  |   |    <span class="dim">+-  PTY master  -+</span>    |               |
  |   |    <span class="dim">|   /dev/ptmx   |</span>    |               |
  |   |    <span class="dim">+---------------+</span>    |               |
  |   |                          |               |
  |   |    <span class="dim">+-  broadcast  --+</span>    |               |
  |   |    <span class="dim">|  4096 buffer  |</span>    |    output     |
  |   |    <span class="dim">+-------+-------+</span>    +-----------&gt;  | <span class="label">clients</span>
  |   |            |             |               |
  |   |    <span class="dim">+-  input chan  --+</span>    |    input      |
  |   |    <span class="dim">|   256 buffer  |</span>    |  &lt;-----------+ |
  |   |    <span class="dim">+---------------+</span>    |               |
  |   |                          |               |
  |   |    <span class="dim">output.log</span>            |               |
  |   |    <span class="dim">events.jsonl</span>          |               |
  |   +--------------------------+               |
  |                                              |
  |   <span class="dim">SubscriptionManager (event pub/sub)</span>          |
  |   <span class="dim">sessions.json (debounced 500ms)</span>              |
  +----------------------------------------------+
                       |
            +----------+----------+
            |                     |
       <span class="label">Unix Socket</span>            <span class="label">WebSocket</span>
       <span class="dim">local clients</span>           <span class="dim">:9100 (opt.)</span>
</div>

  <h3>Relay Topology</h3>
  <p>WireGuard tunneling for remote access. Nodes establish userspace WireGuard tunnels to a relay server &mdash; no root required, works behind NAT.</p>

<div class="diagram" role="img" aria-label="Relay topology diagram">
                          <span class="hl">INTERNET</span>
                             |
                    +--------+--------+
                    |   <span class="label">cw relay</span>      |
                    | HTTPS :443      |  <span class="dim">&lt;- Clients connect here</span>
                    | WG UDP :41820   |  <span class="dim">&lt;- Nodes tunnel here</span>
                    | /api/v1/nodes   |  <span class="dim">&lt;- Node discovery</span>
                    | /api/v1/kv/*    |  <span class="dim">&lt;- Shared KV store</span>
                    +--------+--------+
                        |         |
           WG tunnel    |         |   WG tunnel
           (UDP)        |         |   (UDP)
                        |         |
                +-------+--+  +---+-------+
                | <span class="label">cw node</span>  |  | <span class="label">cw node</span>   |
                | "dev-1"  |  | "gpu-box" |
                +----------+  +-----------+

  <span class="hl">Connection Flow:</span>
  1. Node starts, generates WireGuard key pair
  2. Node registers with relay (device auth flow)
  3. Node creates userspace WG tunnel (no root)
  4. Client calls <span class="dim">GET /api/v1/nodes</span> to discover
  5. Client connects through relay to node
  6. Same wire protocol as local Unix socket
</div>

  <h3>Wire Protocol</h3>
  <p>Binary frame-based protocol used over both Unix socket and WebSocket.</p>

<div class="diagram" role="img" aria-label="Wire protocol frame format">
  <span class="hl">Frame Format</span>
  +----------+---------------+----------------------+
  | <span class="label">type</span>     | <span class="label">length</span>        | <span class="label">payload</span>              |
  | 1 byte   | 4 bytes (BE)  | up to 16 MB          |
  +----------+---------------+----------------------+

  <span class="dim">type = 0x00</span>  Control  <span class="dim">-- JSON-encoded Request/Response</span>
  <span class="dim">type = 0x01</span>  Data     <span class="dim">-- Raw bytes (PTY I/O)</span>

  <span class="hl">WebSocket Mapping</span>
  Text   frames -- Control messages (JSON)
  Binary frames -- Data messages (raw bytes)
</div>
</section>

<!-- ════════════════════════ Relay ════════════════════════ -->
<section id="relay">
  <h2>Remote Access</h2>
  <p>Two tiers: <strong>Standalone</strong> (default, zero config, local only) and <strong>Relay mode</strong> (opt-in remote access via WireGuard).</p>

  <h3>Setup</h3>
  <div class="code-block"><pre><code><span class="cmt"># Authorize your node with a relay</span>
<span class="cmd">cw setup</span> https://relay.codespace.sh

<span class="cmt"># That's it. Your node is now accessible remotely.</span></code></pre><button class="copy-btn" onclick="copyText('cw setup https://relay.codespace.sh',this)">copy</button></div>

  <h3>Remote Commands</h3>
  <p>All commands accept an optional node prefix:</p>
  <div class="code-block"><pre><code><span class="cmd">cw nodes</span>                                  <span class="cmt"># list all nodes</span>
<span class="cmd">cw list</span> dev-1                              <span class="cmt"># sessions on dev-1</span>
<span class="cmd">cw attach</span> dev-1:<span class="num">3</span>                          <span class="cmt"># session 3 on dev-1</span>
<span class="cmd">cw launch</span> dev-1 <span class="flag">--tag</span> worker <span class="flag">--</span> claude <span class="flag">-p</span> <span class="str">"fix bug"</span>
<span class="cmd">cw kill</span> dev-1:<span class="num">3</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>Direct WebSocket</h3>
  <p>You can also connect directly via WebSocket without a relay:</p>
  <div class="code-block"><pre><code><span class="cmd">cw server add</span> my-server wss://remote-host:9100 <span class="flag">--token</span> &lt;token&gt;
<span class="cmd">cw</span> <span class="flag">--server</span> my-server list</code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>
</section>

<!-- ════════════════════════ Configuration ════════════════════════ -->
<section id="configuration">
  <h2>Configuration</h2>

  <h3>Config File</h3>
  <p>Located at <code>~/.codewire/config.toml</code></p>
  <div class="code-block"><pre><code><span class="kw">[node]</span>
<span class="flag">name</span> = <span class="str">"my-node"</span>                          <span class="cmt"># Node name</span>
<span class="flag">listen</span> = <span class="str">"0.0.0.0:9100"</span>                   <span class="cmt"># Direct WebSocket (optional)</span>
<span class="flag">external_url</span> = <span class="str">"wss://host/ws"</span>            <span class="cmt"># Advertised URL</span>
<span class="flag">relay_url</span> = <span class="str">"https://relay.codespace.sh"</span>  <span class="cmt"># Opt-in remote access</span></code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <h3>Environment Variable Overrides</h3>
  <table>
    <thead><tr><th>Variable</th><th>Overrides</th></tr></thead>
    <tbody>
      <tr><td><code>CODEWIRE_NODE_NAME</code></td><td>node.name</td></tr>
      <tr><td><code>CODEWIRE_LISTEN</code></td><td>node.listen</td></tr>
      <tr><td><code>CODEWIRE_EXTERNAL_URL</code></td><td>node.external_url</td></tr>
      <tr><td><code>CODEWIRE_RELAY_URL</code></td><td>node.relay_url</td></tr>
      <tr><td><code>CODEWIRE_TOKEN</code></td><td>Auth token (for containers)</td></tr>
    </tbody>
  </table>

  <h3>Data Directory</h3>
  <p><code>~/.codewire/</code> contains all runtime state.</p>
<div class="diagram" role="img" aria-label="Data directory layout">
~/.codewire/
|-- codewire.sock         <span class="dim"># Unix domain socket</span>
|-- codewire.pid          <span class="dim"># Node PID file</span>
|-- token                 <span class="dim"># Auth token (direct WS fallback)</span>
|-- wg_private_key        <span class="dim"># WireGuard private key (0600)</span>
|-- config.toml           <span class="dim"># Configuration</span>
|-- servers.toml          <span class="dim"># Saved remote servers</span>
|-- sessions.json         <span class="dim"># Session metadata</span>
`-- sessions/
    |-- 1/
    |   |-- output.log    <span class="dim"># Captured PTY output</span>
    |   `-- events.jsonl  <span class="dim"># Metadata event log</span>
    `-- 2/
        |-- output.log
        `-- events.jsonl
</div>
</section>

<!-- ════════════════════════ MCP ════════════════════════ -->
<section id="mcp">
  <h2>MCP Integration</h2>
  <p>CodeWire exposes an MCP server (JSON-RPC 2.0 over stdin/stdout) so AI agents can programmatically manage sessions.</p>

  <h3>Claude Code Config</h3>
  <div class="code-block"><pre><code><span class="cmt"># Add as MCP server (user-level)</span>
<span class="cmd">claude mcp add</span> <span class="flag">--scope</span> user codewire <span class="flag">--</span> cw mcp-server</code></pre><button class="copy-btn" onclick="copyText('claude mcp add --scope user codewire -- cw mcp-server',this)">copy</button></div>

  <h3>Available Tools</h3>
  <table>
    <thead><tr><th>Tool</th><th>Description</th><th>Key Parameters</th></tr></thead>
    <tbody>
      <tr>
        <td><code>codewire_launch_session</code></td>
        <td>Launch a new session</td>
        <td><code>command</code>, <code>working_dir</code>, <code>tags</code></td>
      </tr>
      <tr>
        <td><code>codewire_list_sessions</code></td>
        <td>List all sessions</td>
        <td><code>status_filter</code>: all | running | completed</td>
      </tr>
      <tr>
        <td><code>codewire_read_session_output</code></td>
        <td>Read output snapshot</td>
        <td><code>session_id</code>, <code>tail</code>, <code>max_chars</code></td>
      </tr>
      <tr>
        <td><code>codewire_send_input</code></td>
        <td>Send input to session</td>
        <td><code>session_id</code>, <code>input</code>, <code>auto_newline</code></td>
      </tr>
      <tr>
        <td><code>codewire_watch_session</code></td>
        <td>Monitor (time-bounded)</td>
        <td><code>session_id</code>, <code>max_duration_seconds</code></td>
      </tr>
      <tr>
        <td><code>codewire_get_session_status</code></td>
        <td>Detailed session info</td>
        <td><code>session_id</code></td>
      </tr>
      <tr>
        <td><code>codewire_kill_session</code></td>
        <td>Terminate session</td>
        <td><code>session_id</code>, <code>tags</code></td>
      </tr>
      <tr>
        <td><code>codewire_subscribe</code></td>
        <td>Subscribe to events</td>
        <td><code>tags</code>, <code>event_types</code>, <code>duration_seconds</code></td>
      </tr>
      <tr>
        <td><code>codewire_wait_for</code></td>
        <td>Wait for completion</td>
        <td><code>session_id</code>, <code>tags</code>, <code>condition</code>, <code>timeout</code></td>
      </tr>
      <tr>
        <td><code>codewire_list_nodes</code></td>
        <td>List relay nodes</td>
        <td>&mdash;</td>
      </tr>
      <tr>
        <td><code>codewire_kv_set</code></td>
        <td>Set key-value</td>
        <td><code>namespace</code>, <code>key</code>, <code>value</code>, <code>ttl</code></td>
      </tr>
      <tr>
        <td><code>codewire_kv_get</code></td>
        <td>Get value by key</td>
        <td><code>namespace</code>, <code>key</code></td>
      </tr>
      <tr>
        <td><code>codewire_kv_list</code></td>
        <td>List keys by prefix</td>
        <td><code>namespace</code>, <code>prefix</code></td>
      </tr>
      <tr>
        <td><code>codewire_kv_delete</code></td>
        <td>Delete key</td>
        <td><code>namespace</code>, <code>key</code></td>
      </tr>
    </tbody>
  </table>
</section>

<!-- ════════════════════════ Installation ════════════════════════ -->
<section id="installation">
  <h2>Installation</h2>

  <h3>Homebrew</h3>
  <div class="badges">
    <span class="badge">macOS aarch64</span>
    <span class="badge">macOS x86_64</span>
    <span class="badge">Linux aarch64</span>
    <span class="badge">Linux x86_64</span>
  </div>
  <div class="code-block"><pre><code><span class="cmd">brew install</span> codespacesh/codewire/codewire</code></pre><button class="copy-btn" onclick="copyText('brew install codespacesh/codewire/codewire',this)">copy</button></div>

  <h3>Install Script</h3>
  <p>Downloads the binary, verifies GPG signature and SHA256 checksum.</p>
  <div class="code-block"><pre><code><span class="cmd">curl</span> <span class="flag">-fsSL</span> https://raw.githubusercontent.com/codespacesh/codewire/main/install.sh <span class="flag">|</span> bash</code></pre><button class="copy-btn" onclick="copyText('curl -fsSL https://raw.githubusercontent.com/codespacesh/codewire/main/install.sh | bash',this)">copy</button></div>
  <p>Options: <code>--version VERSION</code>, <code>--prefix DIR</code>, <code>--verbose</code></p>

  <h3>Build from Source</h3>
  <div class="code-block"><pre><code><span class="cmd">go build</span> <span class="flag">-o</span> cw ./cmd/cw
<span class="cmd">sudo mv</span> cw /usr/local/bin/cw</code></pre><button class="copy-btn" onclick="copyText('go build -o cw ./cmd/cw && sudo mv cw /usr/local/bin/cw',this)">copy</button></div>

  <h3>Coder Module</h3>
  <p>Add CodeWire to Coder workspaces with a Terraform module:</p>
  <div class="code-block"><pre><code><span class="kw">module</span> <span class="str">"codewire"</span> {
  <span class="flag">source</span>   = <span class="str">"github.com/codespacesh/codewire//coder-module"</span>
  <span class="flag">agent_id</span> = coder_agent.main.id
  <span class="flag">folder</span>   = <span class="str">"/home/coder/project"</span>
}</code></pre><button class="copy-btn" onclick="copySnippet(this)">copy</button></div>

  <table>
    <thead><tr><th>Variable</th><th>Default</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>agent_id</code></td><td><em>required</em></td><td>The ID of a Coder agent</td></tr>
      <tr><td><code>folder</code></td><td><code>/home/coder</code></td><td>Working directory for sessions</td></tr>
      <tr><td><code>install_codewire</code></td><td><code>true</code></td><td>Whether to install cw</td></tr>
      <tr><td><code>codewire_version</code></td><td><code>latest</code></td><td>Version to install</td></tr>
      <tr><td><code>experiment_report_tasks</code></td><td><code>false</code></td><td>Enable Coder MCP task reporting</td></tr>
    </tbody>
  </table>
</section>

</main>

<!-- ════════════════════════ Footer ════════════════════════ -->
<footer style="text-align:center;padding:24px;border-top:1px solid var(--border);color:var(--fg-dim);font-size:12px;font-family:var(--font-mono)">
  <a href="https://github.com/codespacesh/codewire" style="color:var(--fg-dim)">github.com/codespacesh/codewire</a>
  &nbsp;&middot;&nbsp; MIT License
</footer>

<script>
// ── Theme Toggle ──
function getPreferredTheme() {
  const saved = localStorage.getItem('cw-theme');
  if (saved) return saved;
  return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
}

function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  document.getElementById('theme-icon').textContent = theme === 'light' ? '\u2600' : '\u263E';
}

function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme') || 'dark';
  const next = current === 'dark' ? 'light' : 'dark';
  localStorage.setItem('cw-theme', next);
  applyTheme(next);
}

applyTheme(getPreferredTheme());

window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', (e) => {
  if (!localStorage.getItem('cw-theme')) {
    applyTheme(e.matches ? 'light' : 'dark');
  }
});

// ── Copy Buttons ──
function copyText(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'copied';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'copy';
      btn.classList.remove('copied');
    }, 1500);
  });
}

function copySnippet(btn) {
  const pre = btn.closest('.code-block').querySelector('pre');
  const text = pre.textContent;
  copyText(text, btn);
}
</script>
</body>
</html>
